{% extends 'base.html' %}

{% block content %}

<h1>Search products</h1>

<form action="{% url 'store_search' %}" id="search-form" method="get" class="row row-cols-lg-auto g-3 align-items-center my-3">
  {{ search_form.page }}

  <div class="col-12">
    {{ search_form.search_term }}
  </div>

  <div class="col-12">
    {{ search_form.sort_order }}
  </div>

  <div class="col-12">
    {{ search_form.items_per_page }}
  </div>

  <div class="col-12">
    <button type="submit" class="btn btn-primary">Submit</button>
  </div>
</form>

{% if page %}

<div class="mb-3">
  <small><em>Found {{ count }} results</em></small>
</div>

{% for product in page %}
<div class="card mb-3">
  <div class="row g-0">
    <div class="col-md-4">
      <img src="#" class="img-fluid rounded-start" alt="{{ product.name }} product image">
    </div>
    <div class="col-md-8">
      <div class="card-body">
        <a href="{% url 'store_details' product.id %}" class="h5 card-title">{{ product.name }}</a>
        <p class="card-text">Â£{{ product.price_pounds }}</p>
      </div>
    </div>
  </div>
</div>
{% endfor %}

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item {% if not page.has_previous %}disabled{% endif %}">
      <a id="prev-page" href="#" class="page-link" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
    {% for i in page_range %}
    <li class="page-item {% if i == page.number %}active{% endif %}">
      <a class="page-link page-number-link" href="#" data-page-number="{{ i }}">{{ i }}</a>
    </li>
    {% endfor %}
    <li class="page-item {% if not page.has_next %}disabled{% endif %}">
      <a id="next-page" href="#" class="page-link" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>

{% else %}

<p class="h3 text-center mt-5">No items were found matching the search criteria</p>

{% endif %}

{% endblock %}

{% block scripts %}

<script>
  $(function () {
    $('#prev-page').click(function () {
      $('#id_page').val(Number($('#id_page').val()) - 1);
      $('#search-form').submit();
    });

    $('#next-page').click(function () {
      $('#id_page').val(Number($('#id_page').val()) + 1);
      $('#search-form').submit();
    });

    $('.page-number-link').click(function () {
      $('#id_page').val($(this).data('page-number'));
      $('#search-form').submit();
    });
  });
</script>

{% endblock %}